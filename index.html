<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ - –î–æ–ª–≥–∏ –∏ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --primary: #0088cc;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
            --card-bg: white;
            --border: #ddd;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 12px;
        }

        .header {
            background: var(--card-bg);
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .balance-card {
            background: linear-gradient(135deg, var(--primary), #0066aa);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin-top: 8px;
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .balance-amount {
            font-size: 32px;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 70px;
            padding: 12px 8px;
            border: none;
            background: var(--card-bg);
            border-radius: 30px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            color: #666;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(0,136,204,0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .section h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section h2:before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 4px;
            display: inline-block;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            background: #fafafa;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,136,204,0.1);
            background: white;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(0,136,204,0.2);
        }

        .btn-primary:hover {
            background: #006699;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,136,204,0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .distribution-sliders {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .slider-item {
            margin-bottom: 16px;
        }

        .slider-item label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .slider-item input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            -webkit-appearance: none;
            padding: 0;
        }

        .slider-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,136,204,0.3);
        }

        .debt-item, .invest-item {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
        }

        .debt-header, .invest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .debt-name, .invest-name {
            font-weight: 600;
            font-size: 16px;
        }

        .debt-amount {
            color: var(--danger);
            font-weight: 700;
        }

        .invest-amount {
            color: var(--success);
            font-weight: 700;
        }

        .debt-details, .invest-details {
            display: flex;
            gap: 12px;
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transition: width 0.3s;
        }

        .debt-actions, .invest-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .debt-actions button, .invest-actions button {
            flex: 1;
            padding: 10px;
            font-size: 13px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
        }

        .forecast-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102,126,234,0.3);
        }

        .forecast-card .big-number {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(0,136,204,0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin: 8px 0;
        }

        .stat-label {
            font-size: 13px;
            color: #666;
        }

        .profit {
            color: var(--success);
        }

        .loss {
            color: var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: #999;
            font-size: 14px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 14px;
            border-radius: 30px;
            text-align: center;
            font-size: 14px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .badge {
            padding: 4px 10px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(76,175,80,0.1);
            color: var(--success);
        }

        .badge-danger {
            background: rgba(244,67,54,0.1);
            color: var(--danger);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫</h1>
        <div class="balance-card">
            <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
            <div class="balance-amount" id="balance">0 ‚ÇΩ</div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('income')">üí∞ –î–æ—Ö–æ–¥—ã</button>
        <button class="tab-btn" onclick="showTab('debts')">üìã –î–æ–ª–≥–∏</button>
        <button class="tab-btn" onclick="showTab('investments')">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</button>
        <button class="tab-btn" onclick="showTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    </div>

    <!-- –í–ö–õ–ê–î–ö–ê –î–û–•–û–î–´ -->
    <div id="income-tab" class="tab-content active">
        <div class="section">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥</h2>
            <input type="number" id="income-amount" placeholder="–°—É–º–º–∞ –¥–æ—Ö–æ–¥–∞" min="0" step="100">
            <select id="income-period">
                <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                <option value="yearly">–ï–∂–µ–≥–æ–¥–Ω–æ</option>
            </select>
            <input type="text" id="income-source" placeholder="–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Ö–æ–¥–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
            <button class="btn btn-primary" onclick="addIncome()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥</button>
        </div>

        <div class="section">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h2>
            <div class="distribution-sliders">
                <div class="slider-item">
                    <label>
                        <span>üìã –î–æ–ª–≥–∏</span>
                        <span id="debt-percent">30</span>%
                    </label>
                    <input type="range" id="debt-slider" min="0" max="100" value="30" oninput="updateDistributionSliders()">
                </div>
                <div class="slider-item">
                    <label>
                        <span>üõí –†–∞—Å—Ö–æ–¥—ã</span>
                        <span id="expenses-percent">40</span>%
                    </label>
                    <input type="range" id="expenses-slider" min="0" max="100" value="40" oninput="updateDistributionSliders()">
                </div>
                <div class="slider-item">
                    <label>
                        <span>üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</span>
                        <span id="invest-percent">30</span>%
                    </label>
                    <input type="range" id="invest-slider" min="0" max="100" value="30" oninput="updateDistributionSliders()">
                </div>
            </div>
            <button class="btn btn-success" onclick="saveDistribution()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</button>
        </div>

        <div class="section">
            <h2>üìä –¢–µ–∫—É—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</h2>
            <div id="expenses-list" class="empty-state">–ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
        </div>
    </div>

    <!-- –í–ö–õ–ê–î–ö–ê –î–û–õ–ì–ò -->
    <div id="debts-tab" class="tab-content">
        <div class="section">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥</h2>
            <input type="text" id="debt-name" placeholder="–ö–æ–º—É –¥–æ–ª–∂–Ω—ã / –ù–∞–∑–≤–∞–Ω–∏–µ">
            <input type="number" id="debt-amount" placeholder="–°—É–º–º–∞ –¥–æ–ª–≥–∞" min="0">
            <input type="number" id="debt-interest" placeholder="–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ % (–µ—Å–ª–∏ –µ—Å—Ç—å)" min="0" step="0.1">
            <input type="date" id="debt-deadline">
            <select id="debt-priority">
                <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
                <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
                <option value="low">üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</option>
            </select>
            <button class="btn btn-primary" onclick="addDebt()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥</button>
        </div>

        <div class="section">
            <h2>üìã –°–ø–∏—Å–æ–∫ –¥–æ–ª–≥–æ–≤</h2>
            <div id="debts-list"></div>
        </div>

        <div class="section">
            <h2>‚è±Ô∏è –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–∞—à–µ–Ω–∏—è</h2>
            <div id="repayment-forecast" class="forecast-card">
                <div>–î–æ–±–∞–≤—å—Ç–µ –¥–æ–ª–≥–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</div>
            </div>
        </div>
    </div>

    <!-- –í–ö–õ–ê–î–ö–ê –ò–ù–í–ï–°–¢–ò–¶–ò–ò -->
    <div id="investments-tab" class="tab-content">
        <div class="section">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é</h2>
            <input type="text" id="invest-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏">
            <input type="number" id="invest-amount" placeholder="–°—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π" min="0">
            <input type="number" id="invest-return" placeholder="–û–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å % –≤ –≥–æ–¥" min="0" step="0.1">
            <select id="invest-risk">
                <option value="low">üü¢ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</option>
                <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫</option>
                <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫</option>
            </select>
            <select id="invest-type">
                <option value="stocks">–ê–∫—Ü–∏–∏</option>
                <option value="bonds">–û–±–ª–∏–≥–∞—Ü–∏–∏</option>
                <option value="realty">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                <option value="crypto">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
                <option value="other">–î—Ä—É–≥–æ–µ</option>
            </select>
            <button class="btn btn-primary" onclick="addInvestment()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é</button>
        </div>

        <div class="section">
            <h2>üìä –ü–æ—Ä—Ç—Ñ–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</h2>
            <div id="investments-list"></div>
        </div>

        <div class="section">
            <h2>üìà –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</h2>
            <div id="invest-forecast" class="forecast-card">
                <div>–î–æ–±–∞–≤—å—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</div>
            </div>
        </div>
    </div>

    <!-- –í–ö–õ–ê–î–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
    <div id="stats-tab" class="tab-content">
        <div class="section">
            <h2>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-grid" id="stats-grid"></div>
        </div>

        <div class="section">
            <h2>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h2>
            <div id="financial-metrics"></div>
        </div>

        <div class="section">
            <h2>üéØ –°–æ–≤–µ—Ç—ã</h2>
            <div id="tips" class="forecast-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–≤–µ—Ç—ã...
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="toast" class="toast"></div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let balance = 0;
        let incomes = [];
        let debts = [];
        let investments = [];
        let expenses = [];
        let distribution = {
            debts: 30,
            expenses: 40,
            investments: 30
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        function loadData() {
            const savedData = localStorage.getItem('financeData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    balance = data.balance || 0;
                    incomes = data.incomes || [];
                    debts = data.debts || [];
                    investments = data.investments || [];
                    expenses = data.expenses || [];
                    distribution = data.distribution || distribution;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–∞–π–¥–µ—Ä—ã
                    document.getElementById('debt-slider').value = distribution.debts;
                    document.getElementById('expenses-slider').value = distribution.expenses;
                    document.getElementById('invest-slider').value = distribution.investments;
                    
                    updateDistributionSliders();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', e);
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            const data = {
                balance,
                incomes,
                debts,
                investments,
                expenses,
                distribution
            };
            localStorage.setItem('financeData', JSON.stringify(data));
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            toast.style.background = type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#333';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥
        function formatMoney(amount) {
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            if (!dateString) return '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            return new Date(dateString).toLocaleDateString('ru-RU');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function updateBalance() {
            document.getElementById('balance').textContent = formatMoney(balance);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
            if (tabName === 'debts') {
                updateDebtsList();
                updateRepaymentForecast();
            } else if (tabName === 'investments') {
                updateInvestmentsList();
                updateInvestForecast();
            } else if (tabName === 'stats') {
                updateStats();
                updateTips();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–æ–≤
        function updateDistributionSliders() {
            const debt = parseInt(document.getElementById('debt-slider').value);
            const expenses = parseInt(document.getElementById('expenses-slider').value);
            const invest = parseInt(document.getElementById('invest-slider').value);
            
            const total = debt + expenses + invest;
            
            if (total !== 100) {
                const diff = 100 - total;
                if (event && event.target === document.getElementById('debt-slider')) {
                    document.getElementById('expenses-slider').value = Math.max(0, expenses + diff/2);
                    document.getElementById('invest-slider').value = Math.max(0, 100 - debt - parseInt(document.getElementById('expenses-slider').value));
                } else if (event && event.target === document.getElementById('expenses-slider')) {
                    document.getElementById('debt-slider').value = Math.max(0, debt + diff/2);
                    document.getElementById('invest-slider').value = Math.max(0, 100 - expenses - parseInt(document.getElementById('debt-slider').value));
                } else {
                    document.getElementById('debt-slider').value = Math.max(0, debt + diff/2);
                    document.getElementById('expenses-slider').value = Math.max(0, 100 - invest - parseInt(document.getElementById('debt-slider').value));
                }
            }
            
            document.getElementById('debt-percent').textContent = document.getElementById('debt-slider').value;
            document.getElementById('expenses-percent').textContent = document.getElementById('expenses-slider').value;
            document.getElementById('invest-percent').textContent = document.getElementById('invest-slider').value;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        function saveDistribution() {
            distribution = {
                debts: parseInt(document.getElementById('debt-slider').value),
                expenses: parseInt(document.getElementById('expenses-slider').value),
                investments: parseInt(document.getElementById('invest-slider').value)
            };
            saveData();
            showToast('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∞
        function addIncome() {
            const amount = parseFloat(document.getElementById('income-amount').value);
            const period = document.getElementById('income-period').value;
            const source = document.getElementById('income-source').value || '–î–æ—Ö–æ–¥';
            
            if (!amount || amount <= 0) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }
            
            const income = {
                id: Date.now(),
                amount,
                period,
                source,
                date: new Date().toISOString()
            };
            
            incomes.push(income);
            balance += amount;
            
            // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Ö–æ–¥
            distributeIncome(amount);
            
            updateBalance();
            saveData();
            showToast('–î–æ—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω!', 'success');
            
            document.getElementById('income-amount').value = '';
            document.getElementById('income-source').value = '';
        }

        // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∞
        function distributeIncome(amount) {
            const debtAmount = (amount * distribution.debts) / 100;
            const expensesAmount = (amount * distribution.expenses) / 100;
            const investAmount = (amount * distribution.investments) / 100;
            
            // –ü–ª–∞—Ç–∏–º –ø–æ –¥–æ–ª–≥–∞–º
            if (debtAmount > 0 && debts.length > 0) {
                payDebtsAutomatically(debtAmount);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–¥—ã
            if (expensesAmount > 0) {
                addExpense('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã', expensesAmount);
            }
            
            // –ò–Ω–≤–µ—Å—Ç–∏—Ä—É–µ–º
            if (investAmount > 0 && investments.length > 0) {
                addToInvestments(investAmount);
            }
            
            updateExpensesList();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–ª–∞—Ç–∞ –¥–æ–ª–≥–æ–≤
        function payDebtsAutomatically(amount) {
            let remaining = amount;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–æ–ª–≥–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –∏ —Å—Ä–æ–∫—É
            const sortedDebts = [...debts].sort((a, b) => {
                const priorityWeight = { high: 3, medium: 2, low: 1 };
                return (priorityWeight[b.priority] - priorityWeight[a.priority]) || 
                       (new Date(a.deadline) - new Date(b.deadline));
            });
            
            for (let debt of sortedDebts) {
                if (remaining <= 0) break;
                
                const payment = Math.min(remaining, debt.remaining);
                debt.remaining -= payment;
                remaining -= payment;
                
                if (debt.remaining <= 0) {
                    debts = debts.filter(d => d.id !== debt.id);
                }
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞
        function addExpense(name, amount) {
            const expense = {
                id: Date.now(),
                name,
                amount,
                date: new Date().toISOString()
            };
            expenses.push(expense);
            
            // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Ä–∞—Å—Ö–æ–¥–æ–≤
            if (expenses.length > 50) {
                expenses = expenses.slice(-50);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º
        function addToInvestments(amount) {
            if (investments.length === 0) return;
            
            // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
            const total = investments.reduce((sum, inv) => sum + inv.amount, 0);
            
            for (let inv of investments) {
                const percentage = inv.amount / total;
                inv.currentValue = (inv.currentValue || inv.amount) + (amount * percentage);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–≥–∞
        function addDebt() {
            const name = document.getElementById('debt-name').value;
            const amount = parseFloat(document.getElementById('debt-amount').value);
            const interest = parseFloat(document.getElementById('debt-interest').value) || 0;
            const deadline = document.getElementById('debt-deadline').value;
            const priority = document.getElementById('debt-priority').value;
            
            if (!name || !amount || amount <= 0) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const debt = {
                id: Date.now(),
                name,
                amount,
                remaining: amount,
                interest,
                deadline,
                priority,
                date: new Date().toISOString()
            };
            
            debts.push(debt);
            saveData();
            updateDebtsList();
            updateRepaymentForecast();
            showToast('–î–æ–ª–≥ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            
            document.getElementById('debt-name').value = '';
            document.getElementById('debt-amount').value = '';
            document.getElementById('debt-interest').value = '';
            document.getElementById('debt-deadline').value = '';
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        function addInvestment() {
            const name = document.getElementById('invest-name').value;
            const amount = parseFloat(document.getElementById('invest-amount').value);
            const expectedReturn = parseFloat(document.getElementById('invest-return').value) || 0;
            const risk = document.getElementById('invest-risk').value;
            const type = document.getElementById('invest-type').value;
            
            if (!name || !amount || amount <= 0) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const investment = {
                id: Date.now(),
                name,
                amount,
                currentValue: amount,
                expectedReturn,
                risk,
                type,
                date: new Date().toISOString()
            };
            
            investments.push(investment);
            saveData();
            updateInvestmentsList();
            updateInvestForecast();
            showToast('–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
            
            document.getElementById('invest-name').value = '';
            document.getElementById('invest-amount').value = '';
            document.getElementById('invest-return').value = '';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
        function updateExpensesList() {
            const list = document.getElementById('expenses-list');
            const recent = expenses.slice(-5).reverse();
            
            if (recent.length === 0) {
                list.innerHTML = '<div class="empty-state">–ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>';
                return;
            }
            
            let html = '';
            for (let exp of recent) {
                html += `
                    <div class="debt-item" style="border-left-color: var(--warning);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: 500;">${exp.name}</span>
                            <span style="color: var(--warning); font-weight: 600;">${formatMoney(exp.amount)}</span>
                        </div>
                        <div style="font-size: 12px; color: #666;">
                            ${new Date(exp.date).toLocaleString('ru-RU')}
                        </div>
                    </div>
                `;
            }
            
            list.innerHTML = html;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ–ª–≥–æ–≤
        function updateDebtsList() {
            const list = document.getElementById('debts-list');
            
            if (debts.length === 0) {
                list.innerHTML = '<div class="empty-state">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–æ–ª–≥–æ–≤</div>';
                return;
            }
            
            let html = '';
            for (let debt of debts) {
                const paid = ((debt.amount - debt.remaining) / debt.amount * 100).toFixed(1);
                const priorityColor = debt.priority === 'high' ? 'var(--danger)' : debt.priority === 'medium' ? 'var(--warning)' : 'var(--success)';
                
                html += `
                    <div class="debt-item" style="border-left-color: ${priorityColor};">
                        <div class="debt-header">
                            <span class="debt-name">${debt.name}</span>
                            <span class="debt-amount">${formatMoney(debt.remaining)}</span>
                        </div>
                        <div class="debt-details">
                            <span class="badge ${debt.priority === 'high' ? 'badge-danger' : debt.priority === 'medium' ? 'badge-warning' : 'badge-success'}">
                                ${debt.priority === 'high' ? 'üî¥ –í—ã—Å–æ–∫–∏–π' : debt.priority === 'medium' ? 'üü° –°—Ä–µ–¥–Ω–∏–π' : 'üü¢ –ù–∏–∑–∫–∏–π'}
                            </span>
                            <span>üí∞ –í—Å–µ–≥–æ: ${formatMoney(debt.amount)}</span>
                            ${debt.interest ? `<span>üìä ${debt.interest}%</span>` : ''}
                            ${debt.deadline ? `<span>üìÖ ${formatDate(debt.deadline)}</span>` : ''}
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${paid}%"></div>
                        </div>
                        <div class="debt-actions">
                            <button class="btn-success" onclick="payDebt(${debt.id})">üí∞ –û–ø–ª–∞—Ç–∏—Ç—å</button>
                            <button class="btn-danger" onclick="deleteDebt(${debt.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            }
            
            list.innerHTML = html;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
        function updateInvestmentsList() {
            const list = document.getElementById('investments-list');
            
            if (investments.length === 0) {
                list.innerHTML = '<div class="empty-state">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</div>';
                return;
            }
            
            let html = '';
            for (let inv of investments) {
                const profit = inv.currentValue - inv.amount;
                const profitPercent = ((profit / inv.amount) * 100).toFixed(1);
                const riskColor = inv.risk === 'low' ? 'var(--success)' : inv.risk === 'medium' ? 'var(--warning)' : 'var(--danger)';
                
                html += `
                    <div class="invest-item" style="border-left-color: ${riskColor};">
                        <div class="invest-header">
                            <span class="invest-name">${inv.name}</span>
                            <span class="invest-amount ${profit >= 0 ? 'profit' : 'loss'}">
                                ${profit >= 0 ? '+' : ''}${formatMoney(profit)}
                            </span>
                        </div>
                        <div class="invest-details">
                            <span>üí∞ –ò–Ω–≤–µ—Å—Ç: ${formatMoney(inv.amount)}</span>
                            <span>üìà –¢–µ–∫—É—â: ${formatMoney(inv.currentValue)}</span>
                            <span class="${profit >= 0 ? 'profit' : 'loss'}">${profitPercent}%</span>
                        </div>
                        <div class="invest-details">
                            <span>üéØ ${inv.expectedReturn}% –≥–æ–¥–æ–≤—ã—Ö</span>
                            <span>${inv.type === 'stocks' ? 'üìä –ê–∫—Ü–∏–∏' : inv.type === 'bonds' ? 'üìã –û–±–ª–∏–≥–∞—Ü–∏–∏' : inv.type === 'realty' ? 'üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å' : inv.type === 'crypto' ? '‚Çø –ö—Ä–∏–ø—Ç–æ' : 'üíº –î—Ä—É–≥–æ–µ'}</span>
                        </div>
                        <div class="invest-actions">
                            <button class="btn-success" onclick="updateInvestmentValue(${inv.id})">üìà –û–±–Ω–æ–≤–∏—Ç—å</button>
                            <button class="btn-danger" onclick="deleteInvestment(${inv.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            }
            
            list.innerHTML = html;
        }

        // –û–ø–ª–∞—Ç–∞ –¥–æ–ª–≥–∞
        function payDebt(id) {
            const amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–ª–∞—Ç–µ–∂–∞:');
            if (!amount) return;
            
            const payment = parseFloat(amount);
            if (isNaN(payment) || payment <= 0) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }
            
            const debtIndex = debts.findIndex(d => d.id === id);
            if (debtIndex === -1) return;
            
            if (payment > debts[debtIndex].remaining) {
                showToast('–°—É–º–º–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞', 'error');
                return;
            }
            
            debts[debtIndex].remaining -= payment;
            balance -= payment;
            
            if (debts[debtIndex].remaining <= 0) {
                debts.splice(debtIndex, 1);
            }
            
            addExpense(`–ü–ª–∞—Ç–µ–∂ –ø–æ –¥–æ–ª–≥—É`, payment);
            
            updateBalance();
            updateDebtsList();
            updateRepaymentForecast();
            saveData();
            showToast('–ü–ª–∞—Ç–µ–∂ –≤—ã–ø–æ–ª–Ω–µ–Ω!', 'success');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–ª–≥–∞
        function deleteDebt(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –¥–æ–ª–≥?')) {
                debts = debts.filter(d => d.id !== id);
                updateDebtsList();
                updateRepaymentForecast();
